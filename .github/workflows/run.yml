name: Tempsense_run

on:

    push:
      branches:
        - topic/GCP 
    pull_request:

jobs:
  test_run:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repo
        uses: actions/checkout@v2
        with:
          ref: topic/GCP
        
      - name: Pull antmicro/OL
        run:  |
          cd /home/runner/work
          git clone https://github.com/antmicro/openlane.git
          cp $GITHUB_WORKSPACE/Docker/Dockerfile openlane/docker_build/Dockerfile
          cd openlane/docker_build
          make merge

      - name: Pull OL to make pdk
        run:  |
          cd /home/runner/work
          git clone https://github.com/The-OpenROAD-Project/OpenLane.git
          cd OpenLane
          make pdk

      - name: Locate gen-design folder
        uses: addnab/docker-run-action@v3
        with:
          image: efabless/openlane:current
          options: -v /home/runner/work/OpenFASOC/:/home/runner/work/OpenFASOC/ -v /home/runner/work/OpenLane/:/home/runner/work/OpenLane/
          run:  |
            echo "Running Docker-run action"
            cd /home/runner/work/OpenFASOC/generators/temp-sense-gen
            make sky130hd_temp
